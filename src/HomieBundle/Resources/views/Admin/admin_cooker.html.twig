{% extends '@Homie/Admin/base_admin.html.twig' %}

{% block main %}
    <div class="container">
        <div class="row">
            <div class="col s10 offset-s1">
                {{ form_start(formPhoto) }}
                    {{ form_row(formPhoto.url) }}
                    {{ form_row(formPhoto.alt) }}
                    <button class="btn waves-effect waves-light right black" type="submit" name="action">
                        Add Photo
                        <i class="material-icons left">add</i>
                    </button>
                {{ form_end(formPhoto) }}
            </div>
        </div>

        <div class="row">
            <div class="col s10 offset-s1" id="formCooker">
                {{ form_start(formCooker) }}
                {{ form_row(formCooker.username) }}
                {{ form_row(formCooker.plainPassword) }}
                {{ form_row(formCooker.plainPassword) }}
                {{ form_row(formCooker.address1) }}
                {{ form_row(formCooker.phone) }}
                {{ form_row(formCooker.email) }}
                {{ form_row(formCooker.description) }}
                <button class="btn waves-effect waves-light right black" type="submit" name="action">
                    Add Cooker
                    <i class="material-icons left">add</i>
                </button>
                {{ form_end(formCooker) }}
            </div>
        </div>

        <div class="row">
            <div class="col s10 offset-s1" id="show_cookers">
                {% for cooker in cookers %}
                    <div class="card">
                        <img src="{{ asset('uploads/photos/') }}{{ cooker.photo.url }}" alt="{{ cooker.photo.alt }}">
                        <p>{{ cooker.username }}</p>
                        <p>{{ cooker.address1 }}</p>
                        <p>{{ cooker.phone }}</p>
                        <p>{{ cooker.email }}</p>
                        <a class="waves-effect waves-light btn black delete_btn" id="{{ cooker.id }}">Delete</a>
                        <a href="{{ path('homie_cooker_edit_form', { 'id' : cooker.id }) }}" class="waves-effect waves-light btn black edit_btn">Edit</a>
                    </div>
                {% endfor %}
            </div>

        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        $(document).ready( function (e) {
            $('form[name="homiebundle_photo"]').submit( function (e) {
                e.preventDefault();
                var $data = new FormData($(this)[0]);

                $.ajax({
                    method: 'post',
                    url: "{{ path('homie_cooker_photo_add') }}",
                    processData: false,
                    contentType: false,
                    data: $data,

                    success: function (response) {
                        var $inputToken = $('form[name="app_user_registration"] input[id="app_user_registration__token"]');
                        var idPhoto = response.id;

                        var inputElt = $(document.createElement('input'));
                        inputElt.attr({
                            'value': idPhoto,
                            'type': 'hidden',
                            'name': 'app_user_registration_photo_id',
                            'id' : 'photo_input',
                        });

                        inputElt.insertBefore($inputToken);

                        $('#formCooker').slideDown(800);
                    }
                })
            });

            $('form[name="homiebundle_user"]').submit( function (e) {
                e.preventDefault();
                var $data = new FormData($(this)[0]);

                $.ajax({
                    method: 'post',
                    url: '{{ path('homie_cooker_add') }}',
                    processData: false,
                    contentType: false,
                    data: $data,

                    success: function (response) {
                        console.log(response);
                        var card = $(document.createElement('div'));
                        card.attr('class', 'card');
                        card.css({'background':  'url({{ asset("uploads/photos/") }}' +response.photo.url+') center',
                            'background-size': 'cover',
                            'display': 'none'});

                        var nameCard = $(document.createElement('p'));
                        nameCard.text(response.name);

                        var fornameCard = $(document.createElement('p'));
                        fornameCard.text(response.forname);

                        var address1Card = $(document.createElement('p'));
                        address1Card.text(response.address1);

                        var phoneCard = $(document.createElement('p'));
                        phoneCard.text(response.phone);

                        var emailCard = $(document.createElement('p'));
                        emailCard.text(response.email);

                        var deleteBtn = $(document.createElement('a'));
                        deleteBtn.attr({
                            'class': 'waves-effect waves-light btn black delete_btn',
                            'id': response.id,
                        });
                        deleteBtn.text('supprimer');

                        var editBtn = $(document.createElement('a'));
                        editBtn.attr({
                            'class': 'waves-effect waves-light btn black edit_btn',
                            'id': response.id,
                        });
                        editBtn.text('edit');

                        card.append(nameCard, fornameCard,address1Card, phoneCard, emailCard, deleteBtn, editBtn);


                        $('#show_cookers').prepend(card);
                        card.slideDown(800);

                        $('.delete_btn').on('click', function (e) {
                            var id = $(this).attr('id');
                            e.preventDefault();
                            $.ajax({
                                method: 'get',
                                url:  "{{ path('homie_cooker_delete') }}",
                                data: {'id': id},
                                success: function (response) {
                                    alert(response);
                                    $('#' + id).parent().slideUp(800).remove();
                                }
                            });
                        });

                    },
                    complete: function () {
                        $('form[name="homiebundle_photo"]').trigger('reset');
                        $('form[name="homiebundle_user"]').trigger('reset');
                        $('#formCooker').slideUp(800);
                    }

                });
            });

            $('.delete_btn').on('click', function (e) {
                var id = $(this).attr('id');
                e.preventDefault();
                $.ajax({
                    method: 'get',
                    url:  "{{ path('homie_cooker_delete') }}",
                    data: {'id': id},
                    success: function (response) {
                        alert(response);
                        $('#' + id).parent().slideUp(800).remove();
                    }
                });
            });
        })
    </script>
{% endblock %}